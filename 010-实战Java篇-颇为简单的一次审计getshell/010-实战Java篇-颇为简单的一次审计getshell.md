# 010-实战Java篇-颇为简单的一次审计getshell

## 前言

年少而不可得之人，终会困我一生

本文记录的是：在一次授权渗透测试中从信息收集、源码审计到利用SQL注入、XXE、文件上传最终getshell的过程；加油骚年，没有什么不可得的人或物，牢笼是困不住你的！

## 故事背景

阿SIR，help，有人在搞传销诈骗

大半夜接到任务要透站

作为一个安服仔，没办法，起床，日站

不能整天想妹妹哈哈哈哈~~！

## 信息收集

又是喜闻乐见的信息收集环节，后台是一个登录框，有小程序和商城，目标服务器部署在某讯云，查IP在境外

![](img/01e8b6e83beab99af22fa8cd37e094c.png)

习惯性翻找JS来搜集信息，使用的是国内某个商城系统，xxx admin Java版本

 ![](img/81c648260b0a79e2d8bc66b4d8d7267.png)

既然找到源码厂商是哪家了，就好办了

准备历史漏洞查询打一波，结果发现这个版本没有公开漏洞

那就只能自己来了，自己动手丰衣足食

## 审计实战

**1、SQL注入漏洞【三枚】：**

入口点controller\XXXXController.java

![](img/3c5683521866732227e1a908cd2a3a8.png)

接受POST传参，我们跟进systemStoreService.getNearList，看看具体参数传进去之后怎么去处理的

来到getNearList方法：

![](img/eac423e4320d9981911a5dbe7294209.png)

传参获取两个值request.getLatitude及request.getLongitude，并检测字符串是否为空，满足这两个传参不为空，接着走dao.getNearList

![](img/3260559ec7367aca63119981f038ec5.png)

轻松拿捏，利用${}拼接造成注入，看来开发很给面子，反手送我一个注入，笑嘎嘎！

![](img/f4a4b7d908302a915bbef8ba9047e88.png)

注入出管理的密码加密值，官方存在解密工具，直接利用得到解出后的密码“Admin555222111...”

进入后台，发现文件上传设置修改功能：

![](img/d09468759b2c9309591ea383bc854bc.png)

看到这个功能，比爱情来临时的多巴胺分泌还要多，果断尝试getshell，体验安服仔的快乐爱情！

![](img/427ab55735f3d7d32cf6a119475802a.png)

结果发现shell变成下载了，GG，心凉了大半截，呵呵呵呵

一看就是JAR启的服务，瞬间没心态

没办法，为了RMB，还得重新看看代码，寻找属于我的爱情

**2、XML注入**

\XXXXXController.java

![](img/07de6c9ebeea17709924ebe7142632b.png)

POST接受参数，继续追weChatMessageService.init看看是怎么走的

![](img/87deeb5c24f43e6fc26d0d1ee9aa776.png)

颇为明显的XML注入

![](img/57582b73faa17625f5b94ff8f42c018.png)

同样手拿把掐，直接构造payload打目标站，发现没有反应

一开始考虑是不是没回显，于是去找官方demo站测试一波

![](img/dbbe2b8bd8f2b535b9c1ab800136a3c.png)

官方demo测试没有问题，能带回显出来

回到目标站继续测试无回显，尝试FTP协议外带出来

![](img/612d8fb7c2924267be22bc758c38311.png)

无论怎么更换payload都无法外带出来/etc/passwd

思考了一会儿，同一套源码官方demo可打，目标站不可打

可能是对源码进行了二开或者相关功能模块被关闭了

遂进目标站后台，与官方demo对比发现功能被阉割

但在后台并没有显示，那就抓包手动开启

![](img/032867e63a5fba340cae0dd1c6e2419.png)

抓包官方demo，并把接口与对应ID值记录下来，替换到目标站中成功发包利用

![](img/dabb8367cd2249e6fdc0fbfff433b88.png)

对着目标站直接就一发入魂

![](img/fc54a9daa996541b7f3ef91f7ef6f13.png)

接下来就简单了，读秘钥连服务器连数据库

然而，理想很丰满，现实很骨感，翻了半天没找到秘钥，基本可以进行死亡宣告了

本想休息两天，奈何爱情的力量永远是那么强大！

![](img/47b620b54464b25f10c34cecdd83bc6.png)

**3、峰回路转**

再次进行信息收集，思路：原URL是XXX.XXX.XXX.com  换思路继续缩短域名xxx.xxx.com进行信息收集，果然别有洞天

![](img/257bd6ab11e2ce52a4a2c550efb29d0.png)

发现了疑似运维的机器，存在一个运维面板以及目标站商城

测试发现，后台账号密码、数据库都是同步的

再次利用XXE漏洞，翻文件做信息收集

![](img/831619261c082799bc59ace32baec73.png)

发现tomcat服务，利用刚刚信息收集的ip地址找到对应的服务

一开始是想读shiro秘钥进行getshell，奈何文件太大读不了

于是转变思路，尝试找tomact对应起的web服务，通过目标站后台修改文件上传功能，把文件路径变成tomcatweb路径，最终getshell

![](img/f208f60296e671d809405b061bc9137.png)

发现存在数据库连接

不可得之人，到手，哈哈哈

![](img/81a5bf83670d7f1dedbc60f07527535.png)

## 文末总结

勿忘初心、合法渗透

坚持学习、保持分享

诸君加油共勉，一切皆为可得！